{% extends 'base.html' %}

{% block main %}


<div class="filebrowser"></div>

<button>selection</button>


{% include 'actionbar.html' %}
<script>
var filebrowser = $('.filebrowser').hide();
var browse_btn = $('#actionbar a[title="Browse"]');

var treeview = new Treeview({
    //collapsed: true,
    root_folder: 'Root',
    folders_first: true,
    //only_folders: true,
    //select_one: true,
});
filebrowser.append(treeview.html);
treeview.dblclick_handler = (path, shift) => {
    console.log(path, shift);
};

function toggle_filebrowser() {
    var visible = filebrowser.is(':visible');

    browse_btn.toggleClass('highlight', !visible)
        .find('i').toggleClass('fa-folder', visible)
        .toggleClass('fa-folder-open', !visible);

    filebrowser.toggle(!visible);

    if (!visible) {
        var url = new URL(window.location);
        var search = new URLSearchParams();
        search.set('action', 'list');
        url.search = search;
        $.get(url, (data) => {
            treeview.empty();
            $.each(data.paths, (_, path) => {
                console.log(path);
                treeview.insert(path);
            });
        });
    }
}

browse_btn.on('click', () => {
    toggle_filebrowser();
});

toggle_filebrowser();

$('button').on('click', () => {
    console.log(treeview.get_selected());
});

</script>
{% endblock %}