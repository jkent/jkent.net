{% extends 'base.html' %}

{% block main %}

{% include 'actionbar.html' %}
<script>
let treeview = new Treeview({
    draggable: true,
    droppable: true,
    foreign_drop: true,
    root_folder: 'Root',
});
$('#content').append(treeview.html);
treeview.select_handler = (selection) => {
    console.log('treeview', 'select', selection);
}
treeview.dblclick_handler = (path, shift) => {
    console.log('treeview', 'dblclick', path, shift);
};
treeview.drop_handler = (data) => {
    if (!data.shift) {
        data.source_node.$li.trigger('dragend');
    }
    for (let node of data.selected_parents) {
        [_, paths] = data.source_tree.list(node);
        data.dest_tree.insert(paths, data.dest_node.path);
        if (!data.shift) {
            data.source_tree.remove(node);
        }
    }
};

let url = new URL(window.location);
let search = new URLSearchParams();
search.set('action', 'list');
url.search = search;
$.get(url, (data) => {
    treeview.empty();
    $.each(data.paths, (_, path) => {
        treeview.insert(path);
    });
});

$('#content').append('<hr>');
let treeview2 = new Treeview({
    draggable: true,
    droppable: true,
    foreign_drop: true,
    root_folder: 'Root',
});
$('#content').append(treeview2.html);
treeview2.select_handler = (selection) => {
    console.log('treeview2', 'select', selection);
}
treeview2.dblclick_handler = (path, shift) => {
    console.log('treeview2', 'dblclick', path, shift);
};
treeview2.drop_handler = (data) => {
    if (!data.shift) {
        data.source_node.$li.trigger('dragend');
    }
    for (let node of data.selected_parents) {
        [_, paths] = data.source_tree.list(node);
        data.dest_tree.insert(paths, data.dest_node.path);
        if (!data.shift) {
            data.source_tree.remove(node);
        }
    }
};
</script>
{% endblock %}